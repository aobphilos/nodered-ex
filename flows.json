[
  {
    "id": "5ae0159f.15184c",
    "type": "tab",
    "label": "Proxy",
    "disabled": false,
    "info": ""
  },
  {
    "id": "cf8099bf.e74d38",
    "type": "tab",
    "label": "AQI - Eko",
    "disabled": false,
    "info": ""
  },
  {
    "id": "7a35a7df.308d48",
    "type": "tab",
    "label": "AQI - AirVisual",
    "disabled": false,
    "info": ""
  },
  {
    "id": "f56afe81.c9c94",
    "type": "tab",
    "label": "Corona Virus",
    "disabled": false,
    "info": ""
  },
  {
    "id": "15974936.7b18a7",
    "type": "tab",
    "label": "MQTT Broker",
    "disabled": false,
    "info": ""
  },
  {
    "id": "8f2390e0.2d8a9",
    "type": "tab",
    "label": "Batify Bot",
    "disabled": false,
    "info": ""
  },
  {
    "id": "48a42e48.74137",
    "type": "ui_base",
    "theme": {
      "name": "theme-dark",
      "lightTheme": {
        "default": "#0094CE",
        "baseColor": "#0094CE",
        "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
        "edited": true,
        "reset": false
      },
      "darkTheme": {
        "default": "#097479",
        "baseColor": "#097479",
        "baseFont": "Times New Roman,Times,serif",
        "edited": true,
        "reset": false
      },
      "customTheme": {
        "name": "Untitled Theme 1",
        "default": "#4B7930",
        "baseColor": "#4B7930",
        "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
      },
      "themeState": {
        "base-color": {
          "default": "#097479",
          "value": "#097479",
          "edited": false
        },
        "page-titlebar-backgroundColor": {
          "value": "#097479",
          "edited": false
        },
        "page-backgroundColor": { "value": "#111111", "edited": false },
        "page-sidebar-backgroundColor": { "value": "#000000", "edited": false },
        "group-textColor": { "value": "#0eb8c0", "edited": false },
        "group-borderColor": { "value": "#555555", "edited": false },
        "group-backgroundColor": { "value": "#333333", "edited": false },
        "widget-textColor": { "value": "#eeeeee", "edited": false },
        "widget-backgroundColor": { "value": "#097479", "edited": false },
        "widget-borderColor": { "value": "#333333", "edited": false },
        "base-font": { "value": "Times New Roman,Times,serif" }
      },
      "angularTheme": {
        "primary": "indigo",
        "accents": "blue",
        "warn": "red",
        "background": "grey"
      }
    },
    "site": {
      "name": "Node-RED Dashboard",
      "hideToolbar": "false",
      "allowSwipe": "false",
      "lockMenu": "false",
      "allowTempTheme": "true",
      "dateFormat": "DD/MM/YYYY",
      "sizes": {
        "sx": 48,
        "sy": 48,
        "gx": 6,
        "gy": 6,
        "cx": 6,
        "cy": 6,
        "px": 0,
        "py": 0
      }
    }
  },
  {
    "id": "3bccd41d.0e6efc",
    "type": "ui_tab",
    "z": "",
    "name": "Dashboard",
    "icon": "dashboard",
    "order": 1,
    "disabled": false,
    "hidden": false
  },
  {
    "id": "7b469d8d.557a74",
    "type": "ui_group",
    "z": "",
    "name": "Outdoor",
    "tab": "3bccd41d.0e6efc",
    "order": 2,
    "disp": true,
    "width": "6",
    "collapse": true
  },
  {
    "id": "14884f49.fb2b41",
    "type": "ui_group",
    "z": "",
    "name": "Weather",
    "tab": "3bccd41d.0e6efc",
    "order": 3,
    "disp": true,
    "width": "6",
    "collapse": true
  },
  {
    "id": "1ec0d74d.18d769",
    "type": "ui_link",
    "z": "",
    "name": "Corona Virus",
    "link": "https://www.worldometers.info/coronavirus/",
    "icon": "fa-heartbeat",
    "target": "iframe",
    "order": 3
  },
  {
    "id": "edbd4cf7.b984a",
    "type": "ui_link",
    "z": "",
    "name": "AirVisual",
    "link": "https://www.airvisual.com/thailand/bangkok",
    "icon": "toys",
    "target": "iframe",
    "order": 2
  },
  {
    "id": "f6849123.e05da",
    "type": "ui_group",
    "z": "",
    "name": "Corona Virus",
    "tab": "3bccd41d.0e6efc",
    "order": 4,
    "disp": true,
    "width": "6",
    "collapse": true
  },
  { "id": "24d898f8.bda1b8", "type": "ngrokauth", "z": "" },
  {
    "id": "82d75fe6.a2011",
    "type": "mqtt-broker",
    "z": "",
    "name": "MQTT Local",
    "broker": "broker",
    "port": "1883",
    "clientid": "",
    "usetls": false,
    "compatmode": true,
    "keepalive": "60",
    "cleansession": true,
    "birthTopic": "",
    "birthQos": "0",
    "birthPayload": "",
    "closeTopic": "",
    "closeQos": "0",
    "closePayload": "",
    "willTopic": "",
    "willQos": "0",
    "willPayload": ""
  },
  {
    "id": "8675a6a8.d229b8",
    "type": "mqtt-broker",
    "z": "",
    "name": "Soldier Cloud",
    "broker": "soldier.cloudmqtt.com",
    "port": "14037",
    "clientid": "",
    "usetls": false,
    "compatmode": true,
    "keepalive": "60",
    "cleansession": true,
    "birthTopic": "",
    "birthQos": "0",
    "birthPayload": "",
    "closeTopic": "",
    "closeQos": "0",
    "closePayload": "",
    "willTopic": "",
    "willQos": "0",
    "willPayload": ""
  },
  {
    "id": "93797725.a3d6e8",
    "type": "ui_group",
    "z": "",
    "name": "Indoor",
    "tab": "3bccd41d.0e6efc",
    "order": 1,
    "disp": true,
    "width": "6",
    "collapse": true
  },
  {
    "id": "7190acf.653b054",
    "type": "ui_group",
    "z": "",
    "name": "Tools",
    "tab": "3bccd41d.0e6efc",
    "order": 5,
    "disp": true,
    "width": "6",
    "collapse": true
  },
  {
    "id": "df6f428b.d83cf",
    "type": "comment",
    "z": "7a35a7df.308d48",
    "name": "Sample: Retrieve AQI (AirVisual)",
    "info": "",
    "x": 170,
    "y": 40,
    "wires": []
  },
  {
    "id": "6b994278.3fd71c",
    "type": "http request",
    "z": "7a35a7df.308d48",
    "name": "AirVisual API",
    "method": "GET",
    "ret": "obj",
    "paytoqs": true,
    "url": "https://api.airvisual.com/v2/nearest_city",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "x": 710,
    "y": 100,
    "wires": [["5651191a.672c98"]]
  },
  {
    "id": "7290bb8d.5b3164",
    "type": "inject",
    "z": "7a35a7df.308d48",
    "name": "Inject Every - 1 hour",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "3600",
    "crontab": "",
    "once": true,
    "onceDelay": "1",
    "x": 140,
    "y": 100,
    "wires": [["c55f6f1.3a6129"]],
    "outputLabels": ["inject"],
    "icon": "font-awesome/fa-feed"
  },
  {
    "id": "e6d2e3ff.cf5a5",
    "type": "function",
    "z": "7a35a7df.308d48",
    "name": "Transform Data",
    "func": "function transformData() {\n  const { status, data } = flow.get('airData') || {};\n\n  if (status !== 'success')\n    return {\n      payload: { status: 'failed', message: 'Cannot get any data from API' }\n    };\n\n  return [\n    {\n      payload: {\n        status,\n        data\n      }\n    },\n    {\n      weather: data.current.weather\n    },\n    {\n      city: data.city,\n      state: data.state,\n      country: data.country,\n      pollution: data.current.pollution\n    }\n  ];\n}\n\nreturn transformData();\n",
    "outputs": 3,
    "noerr": 0,
    "x": 360,
    "y": 320,
    "wires": [
      ["af4b133.697f7f", "d0d361bd.91405"],
      ["ca447619.cb6708"],
      ["3e2c0fb9.27763"]
    ]
  },
  {
    "id": "205c2369.1c05dc",
    "type": "ui_template",
    "z": "7a35a7df.308d48",
    "group": "14884f49.fb2b41",
    "name": "Weather Box",
    "order": 1,
    "width": 6,
    "height": 4,
    "format": "<div style=\"text-align: center;\" >\n  <div  style=\"height: 80px; display:inline-block; padding-right: 10px;\">\n    <img src=\"{{msg.payload.url}}\" alt=\"{{msg.payload.desc}}\" title=\"{{msg.payload.desc}}\" width=\"75\" /><br/>\n  </div>\n  <div  style=\"display:inline-block;margin-top: 19px;vertical-align: top;font-size: 35px;\">\n    <span>{{msg.payload.temp}}°</span>\n  </div>\n  <div style=\"width: 100%; text-transform: capitalize;\">\n    <h3>{{msg.payload.desc}}</h3>\n  </div>\n</div>",
    "storeOutMessages": true,
    "fwdInMessages": true,
    "templateScope": "local",
    "x": 890,
    "y": 360,
    "wires": [[]]
  },
  {
    "id": "ca447619.cb6708",
    "type": "function",
    "z": "7a35a7df.308d48",
    "name": "Mapping Weather Icon",
    "func": "const { ic, tp: temp }  = msg.weather;\nlet desc = 'Weather Icon';\nlet icon = ic; \nswitch (ic){\n    case '01d': desc='clear sky (day)'; break;\n    case '01n': desc='clear sky (night)'; break;\n    case '02d': desc='few clouds (day)'; break;\n    case '02n': desc='few clouds (night)'; break;\n    case '03n': \n    case '03d': icon = '03d'; desc='scattered clouds'; break;\n    case '04n': \n    case '04d': icon = '04d'; desc='broken clouds'; break;\n    case '09n': \n    case '09d': icon = '09d'; desc='shower rain'; break;\n    case '10d': desc='rain (day time)'; break;\n    case '10n': desc='rain (night time)'; break;\n    case '11n': \n    case '11d': icon = '11d'; desc='thunderstorm'; break;\n    case '13n': \n    case '13d': icon = '13d'; desc='snow'; break;\n    case '50n': \n    case '50d': icon = '50d'; desc='mist'; break;\n}\nreturn {\n    payload: {\n        url: `https://www.airvisual.com/images/${icon}.png`,\n        desc: desc,\n        temp\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 620,
    "y": 360,
    "wires": [["205c2369.1c05dc"]]
  },
  {
    "id": "285ad985.5d98b6",
    "type": "comment",
    "z": "7a35a7df.308d48",
    "name": "Display Icon by Weather",
    "info": "",
    "x": 930,
    "y": 320,
    "wires": []
  },
  {
    "id": "3e2c0fb9.27763",
    "type": "function",
    "z": "7a35a7df.308d48",
    "name": "Mapping US AQI",
    "func": "const { city, state, country, pollution } = msg;\nreturn {\n    topic: `${city} / ${state}`,\n    payload: { aqi: pollution.aqius }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 610,
    "y": 460,
    "wires": [["1c983616.c13dfa"]]
  },
  {
    "id": "1c983616.c13dfa",
    "type": "ui_gauge",
    "z": "7a35a7df.308d48",
    "name": "AQI Box",
    "group": "7b469d8d.557a74",
    "order": 1,
    "width": 6,
    "height": 4,
    "gtype": "gage",
    "title": "{{topic}}",
    "label": "µg/m³",
    "format": "{{payload.aqi}}",
    "min": 0,
    "max": "300",
    "colors": ["#40e400", "#ffff00", "#f91000"],
    "seg1": "Moderate",
    "seg2": "Unhealthy",
    "x": 880,
    "y": 460,
    "wires": []
  },
  {
    "id": "3406e82e.317ac8",
    "type": "comment",
    "z": "7a35a7df.308d48",
    "name": "Display US AQI",
    "info": "",
    "x": 900,
    "y": 420,
    "wires": []
  },
  {
    "id": "4b2365f4.97fe8c",
    "type": "debug",
    "z": "7a35a7df.308d48",
    "name": "Console - Raw",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1090,
    "y": 100,
    "wires": []
  },
  {
    "id": "43b5b94f.58c4b8",
    "type": "function",
    "z": "7a35a7df.308d48",
    "name": "Extract Env.",
    "func": "return {\n    headers: {\n        'x-forwarded-for': msg.payload.publicIPv4\n    },\n    payload: {\n        city: env.get('AIRVISUAL_CITY'),\n        state: env.get('AIRVISUAL_STATE'),\n        country:env.get('AIRVISUAL_COUNTRY'),\n        key: env.get('AIRVISUAL_KEY')\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 530,
    "y": 100,
    "wires": [["6b994278.3fd71c"]]
  },
  {
    "id": "d07b7bb2.0acb28",
    "type": "complete",
    "z": "7a35a7df.308d48",
    "name": "Trigger AirData",
    "scope": ["5651191a.672c98"],
    "uncaught": false,
    "x": 120,
    "y": 320,
    "wires": [["e6d2e3ff.cf5a5"]]
  },
  {
    "id": "af4b133.697f7f",
    "type": "debug",
    "z": "7a35a7df.308d48",
    "name": "Console - airData",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 600,
    "y": 200,
    "wires": []
  },
  {
    "id": "5651191a.672c98",
    "type": "function",
    "z": "7a35a7df.308d48",
    "name": "Save Data",
    "func": "function saveData({payload}) {\n    flow.set('airData', payload);\n    return flow.get('airData');\n}\n\nreturn saveData(msg);",
    "outputs": 1,
    "noerr": 0,
    "x": 890,
    "y": 100,
    "wires": [["4b2365f4.97fe8c"]]
  },
  {
    "id": "8343aaa.1b45458",
    "type": "comment",
    "z": "7a35a7df.308d48",
    "name": "When air data has been saved it trigger immediately.",
    "info": "",
    "x": 230,
    "y": 240,
    "wires": []
  },
  {
    "id": "bb3429ca.e71668",
    "type": "inject",
    "z": "f56afe81.c9c94",
    "name": "Inject Every - 1 hour",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "3600",
    "crontab": "",
    "once": true,
    "onceDelay": "1",
    "x": 140,
    "y": 120,
    "wires": [["23b02522.3d2faa"]]
  },
  {
    "id": "23b02522.3d2faa",
    "type": "http request",
    "z": "f56afe81.c9c94",
    "name": "Request Data",
    "method": "GET",
    "ret": "txt",
    "paytoqs": false,
    "url": "https://www.worldometers.info/coronavirus/",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "x": 360,
    "y": 120,
    "wires": [["11e289b6.707d26"]]
  },
  {
    "id": "e893e6e0.46b898",
    "type": "debug",
    "z": "f56afe81.c9c94",
    "name": "Console - Raw",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 940,
    "y": 120,
    "wires": []
  },
  {
    "id": "11e289b6.707d26",
    "type": "html",
    "z": "f56afe81.c9c94",
    "name": "Scraping Data",
    "property": "payload",
    "outproperty": "payload",
    "tag": "[id*='maincounter-wrap']",
    "ret": "text",
    "as": "single",
    "x": 560,
    "y": 120,
    "wires": [["b3314734.a11bb8"]]
  },
  {
    "id": "72027117.74c38",
    "type": "comment",
    "z": "f56afe81.c9c94",
    "name": "Scraping data from Worldometers",
    "info": "[Corona Virus](https://www.worldometers.info/coronavirus/)",
    "x": 180,
    "y": 57,
    "wires": []
  },
  {
    "id": "b51a99ae.3f8728",
    "type": "function",
    "z": "f56afe81.c9c94",
    "name": "Transform Data",
    "func": "function transformData() {\n  let virus = {};\n  const { payload: content } = flow.get(\"virusData\");\n\n  if (Array.isArray(content)) {\n    content.forEach(item => {\n      if (item) {\n        const [key, value] = item.split(\": \");\n        virus[`${key.trim()}`] = value.trim();\n      }\n    });\n  }\n  return virus;\n}\nreturn {\n  payload: transformData()\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 360,
    "y": 300,
    "wires": [["6a5659a9.785d38", "9d5abe7a.3372", "dd63e5bb.e301c8"]]
  },
  {
    "id": "9c01ecb6.96cd6",
    "type": "complete",
    "z": "f56afe81.c9c94",
    "name": "Trigger virusData",
    "scope": ["b3314734.a11bb8"],
    "uncaught": false,
    "x": 120,
    "y": 300,
    "wires": [["b51a99ae.3f8728"]]
  },
  {
    "id": "b3314734.a11bb8",
    "type": "function",
    "z": "f56afe81.c9c94",
    "name": "Save Data",
    "func": "function saveData({ payload }) {\n    flow.set('virusData', { payload });\n    return flow.get('virusData');\n}\n\nreturn saveData(msg);",
    "outputs": 1,
    "noerr": 0,
    "x": 750,
    "y": 120,
    "wires": [["e893e6e0.46b898"]]
  },
  {
    "id": "d161845.4032c78",
    "type": "comment",
    "z": "f56afe81.c9c94",
    "name": "When virus data has been saved it trigger immediately.",
    "info": "",
    "x": 240,
    "y": 240,
    "wires": []
  },
  {
    "id": "6a5659a9.785d38",
    "type": "debug",
    "z": "f56afe81.c9c94",
    "name": "Console - virusData",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 640,
    "y": 240,
    "wires": []
  },
  {
    "id": "cbe4d159.7d614",
    "type": "ui_template",
    "z": "f56afe81.c9c94",
    "group": "f6849123.e05da",
    "name": "Corona Box",
    "order": 1,
    "width": 6,
    "height": 4,
    "format": "<style>\n    .gray {\n        color: white;\n    }\n    .red {\n        color: red;\n    }\n    .green {\n        color: #01da01;\n    }\n    .main {\n        text-align: center;\n        font-size: large;\n    }\n    .main div {\n        padding-bottom: 10px;\n    }\n</style>\n<div class=\"main\" ng-bind-html=\"msg.payload\"></div>",
    "storeOutMessages": true,
    "fwdInMessages": true,
    "templateScope": "local",
    "x": 830,
    "y": 360,
    "wires": [[]]
  },
  {
    "id": "9d5abe7a.3372",
    "type": "function",
    "z": "f56afe81.c9c94",
    "name": "Build HTML",
    "func": "function buildTemplate({ payload }) {\n  return Object.entries(payload)\n    .map(([key, value], i) => {\n      let css = \"gray\";\n\n      if (i === 1) css = \"red\";\n      else if (i === 2) css = \"green\";\n\n      return `<div class=\"${css}\"><h3>${key}</h3><span>${value}</span></div>`;\n    })\n    .join(\"\");\n}\nreturn {\n  payload: buildTemplate(msg)\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 610,
    "y": 360,
    "wires": [["cbe4d159.7d614"]]
  },
  {
    "id": "36a6c0c0.fa627",
    "type": "sendgrid",
    "z": "5ae0159f.15184c",
    "from": "",
    "to": "",
    "name": "Send Email",
    "content": "html",
    "x": 1110,
    "y": 140,
    "wires": []
  },
  {
    "id": "34f2c33e.e8de1c",
    "type": "debug",
    "z": "5ae0159f.15184c",
    "name": "Console - ngrok",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 370,
    "y": 200,
    "wires": []
  },
  {
    "id": "953c017.0631d",
    "type": "debug",
    "z": "5ae0159f.15184c",
    "name": "Console - Body",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 820,
    "y": 200,
    "wires": []
  },
  {
    "id": "c501b1f1.7c566",
    "type": "inject",
    "z": "5ae0159f.15184c",
    "name": "Turn on",
    "topic": "",
    "payload": "on",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "x": 100,
    "y": 120,
    "wires": [["52928c8b.b1aa04"]]
  },
  {
    "id": "ae26b0c5.3b27c",
    "type": "catch",
    "z": "5ae0159f.15184c",
    "name": "Catch All",
    "scope": null,
    "uncaught": false,
    "x": 100,
    "y": 600,
    "wires": [["ef94acc.ae0335"]]
  },
  {
    "id": "ef94acc.ae0335",
    "type": "debug",
    "z": "5ae0159f.15184c",
    "name": "Error Log",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 310,
    "y": 600,
    "wires": []
  },
  {
    "id": "e4d48288.317d5",
    "type": "function",
    "z": "5ae0159f.15184c",
    "name": "Prepare email Data",
    "func": "function buildTemplate(url) {\n    return `\n    <div style='margin 6%;'>\n        <a href=\"${url}/ui/\" target=\"_blank\">My Node-RED URL</a>\n    </div>`;    \n}\nfunction prepareEmailData({ payload }) {\n  const url = payload;\n   return {\n      topic: 'My Node-RED URL',\n      payload: buildTemplate(url),\n      key: env.get('SENDGRID_API_KEY'),\n      from: { email: env.get('SENDGRID_FROM'), name: 'Batify Bot' },\n      to: env.get('SENDGRID_TO')\n    };\n}\nreturn prepareEmailData(msg);\n",
    "outputs": 1,
    "noerr": 0,
    "x": 830,
    "y": 140,
    "wires": [["36a6c0c0.fa627", "953c017.0631d"]]
  },
  {
    "id": "aa3ce080.787ef",
    "type": "inject",
    "z": "5ae0159f.15184c",
    "name": "Turn off",
    "topic": "",
    "payload": "off",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 180,
    "wires": [["52928c8b.b1aa04"]]
  },
  {
    "id": "bd2c79e7.cb4ce8",
    "type": "comment",
    "z": "5ae0159f.15184c",
    "name": "!!! Bootstrapper Proxy !!!",
    "info": "",
    "x": 150,
    "y": 80,
    "wires": []
  },
  {
    "id": "52928c8b.b1aa04",
    "type": "ngrok",
    "z": "5ae0159f.15184c",
    "port": "",
    "creds": "24d898f8.bda1b8",
    "subdomain": "",
    "name": "",
    "auth": "",
    "x": 330,
    "y": 140,
    "wires": [["34f2c33e.e8de1c", "373fda00.1de276"]]
  },
  {
    "id": "e4d25816.f4e308",
    "type": "comment",
    "z": "5ae0159f.15184c",
    "name": "Handle All Error Exceptions",
    "info": "",
    "x": 150,
    "y": 540,
    "wires": []
  },
  {
    "id": "1dafa158.c0adff",
    "type": "comment",
    "z": "5ae0159f.15184c",
    "name": "Custom sendgrid configuration",
    "info": "## Can assign any data that SendGrid API has to provide\n - API key\n - Send To Email\n - Send From Email(s)\n - Body Message\n - Body with Attachment\n - File Name\n - Template ID\n - Template Data\n",
    "x": 860,
    "y": 100,
    "wires": []
  },
  {
    "id": "34e8fb9b.f613c4",
    "type": "comment",
    "z": "5ae0159f.15184c",
    "name": "Send email via Sendgrid API",
    "info": "",
    "x": 1160,
    "y": 100,
    "wires": []
  },
  {
    "id": "b48e993b.df2018",
    "type": "status",
    "z": "5ae0159f.15184c",
    "name": "",
    "scope": null,
    "x": 640,
    "y": 600,
    "wires": [["d0b702.6c5ab9"]]
  },
  {
    "id": "d0b702.6c5ab9",
    "type": "debug",
    "z": "5ae0159f.15184c",
    "name": "Console - Status",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 890,
    "y": 600,
    "wires": []
  },
  {
    "id": "3aae570.e5780aa",
    "type": "comment",
    "z": "5ae0159f.15184c",
    "name": "Handle All Node Status",
    "info": "",
    "x": 680,
    "y": 540,
    "wires": []
  },
  {
    "id": "b633ff6a.dd257",
    "type": "catch",
    "z": "7a35a7df.308d48",
    "name": "Catch All",
    "scope": null,
    "uncaught": false,
    "x": 100,
    "y": 620,
    "wires": [["5a233be0.1ad334"]]
  },
  {
    "id": "5a233be0.1ad334",
    "type": "debug",
    "z": "7a35a7df.308d48",
    "name": "Error Log",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 310,
    "y": 620,
    "wires": []
  },
  {
    "id": "a3c1689f.fff2f8",
    "type": "comment",
    "z": "7a35a7df.308d48",
    "name": "Handle All Error Exceptions",
    "info": "",
    "x": 150,
    "y": 560,
    "wires": []
  },
  {
    "id": "1d4105ca.29139a",
    "type": "status",
    "z": "7a35a7df.308d48",
    "name": "",
    "scope": null,
    "x": 620,
    "y": 620,
    "wires": [["ed26a6a7.6002b8"]]
  },
  {
    "id": "ed26a6a7.6002b8",
    "type": "debug",
    "z": "7a35a7df.308d48",
    "name": "Console - Status",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 870,
    "y": 620,
    "wires": []
  },
  {
    "id": "8fe3e8ff.788348",
    "type": "comment",
    "z": "7a35a7df.308d48",
    "name": "Handle All Node Status",
    "info": "",
    "x": 660,
    "y": 560,
    "wires": []
  },
  {
    "id": "d650a369.55684",
    "type": "catch",
    "z": "f56afe81.c9c94",
    "name": "Catch All",
    "scope": null,
    "uncaught": false,
    "x": 100,
    "y": 640,
    "wires": [["666dc280.56dc3c"]]
  },
  {
    "id": "666dc280.56dc3c",
    "type": "debug",
    "z": "f56afe81.c9c94",
    "name": "Error Log",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 310,
    "y": 640,
    "wires": []
  },
  {
    "id": "97e77c50.1ca33",
    "type": "comment",
    "z": "f56afe81.c9c94",
    "name": "Handle All Error Exceptions",
    "info": "",
    "x": 150,
    "y": 580,
    "wires": []
  },
  {
    "id": "6298bd26.c25f24",
    "type": "status",
    "z": "f56afe81.c9c94",
    "name": "",
    "scope": null,
    "x": 600,
    "y": 640,
    "wires": [["4957a179.06ddc"]]
  },
  {
    "id": "4957a179.06ddc",
    "type": "debug",
    "z": "f56afe81.c9c94",
    "name": "Console - Status",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 850,
    "y": 640,
    "wires": []
  },
  {
    "id": "3d21362e.9f5dca",
    "type": "comment",
    "z": "f56afe81.c9c94",
    "name": "Handle All Node Status",
    "info": "",
    "x": 640,
    "y": 580,
    "wires": []
  },
  {
    "id": "c55f6f1.3a6129",
    "type": "ip",
    "z": "7a35a7df.308d48",
    "name": "Public IP",
    "https": false,
    "timeout": "5000",
    "internalIPv4": true,
    "internalIPv6": false,
    "publicIPv4": true,
    "publicIPv6": false,
    "x": 360,
    "y": 100,
    "wires": [["43b5b94f.58c4b8"]]
  },
  {
    "id": "fba75b95.ab6088",
    "type": "catch",
    "z": "15974936.7b18a7",
    "name": "Catch All",
    "scope": null,
    "uncaught": false,
    "x": 120,
    "y": 660,
    "wires": [["63b78d29.26ff84"]]
  },
  {
    "id": "63b78d29.26ff84",
    "type": "debug",
    "z": "15974936.7b18a7",
    "name": "Error Log",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 330,
    "y": 660,
    "wires": []
  },
  {
    "id": "90289810.dfdcd8",
    "type": "comment",
    "z": "15974936.7b18a7",
    "name": "Handle All Error Exceptions",
    "info": "",
    "x": 170,
    "y": 600,
    "wires": []
  },
  {
    "id": "e86ed237.fb0ef",
    "type": "status",
    "z": "15974936.7b18a7",
    "name": "",
    "scope": null,
    "x": 620,
    "y": 660,
    "wires": [["beb79f8e.251bc"]]
  },
  {
    "id": "beb79f8e.251bc",
    "type": "debug",
    "z": "15974936.7b18a7",
    "name": "Console - Status",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 870,
    "y": 660,
    "wires": []
  },
  {
    "id": "5ab43c19.800184",
    "type": "comment",
    "z": "15974936.7b18a7",
    "name": "Handle All Node Status",
    "info": "",
    "x": 660,
    "y": 600,
    "wires": []
  },
  {
    "id": "26f45cd.d6b94a4",
    "type": "inject",
    "z": "15974936.7b18a7",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 140,
    "y": 100,
    "wires": [["203a9317.51028c"]]
  },
  {
    "id": "a96d1de3.c3239",
    "type": "mqtt in",
    "z": "15974936.7b18a7",
    "name": "Sub: sensors/aqi/outdoor",
    "topic": "sensors/aqi/outdoor",
    "qos": "2",
    "datatype": "auto",
    "broker": "82d75fe6.a2011",
    "x": 170,
    "y": 160,
    "wires": [["29ec1b42.4db604"]]
  },
  {
    "id": "203a9317.51028c",
    "type": "mqtt out",
    "z": "15974936.7b18a7",
    "name": "Pub: sensors/aqi/outdoor",
    "topic": "sensors/aqi/outdoor",
    "qos": "",
    "retain": "",
    "broker": "82d75fe6.a2011",
    "x": 470,
    "y": 100,
    "wires": []
  },
  {
    "id": "29ec1b42.4db604",
    "type": "debug",
    "z": "15974936.7b18a7",
    "name": "Console - MQTT",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 450,
    "y": 160,
    "wires": []
  },
  {
    "id": "e3282dd6.1a1a9",
    "type": "comment",
    "z": "cf8099bf.e74d38",
    "name": "Sample: Retrieve AQI (Eko)",
    "info": "",
    "x": 150,
    "y": 80,
    "wires": []
  },
  {
    "id": "7ad159b.cadf8a8",
    "type": "ui_gauge",
    "z": "cf8099bf.e74d38",
    "name": "AQI Box",
    "group": "93797725.a3d6e8",
    "order": 1,
    "width": 6,
    "height": 4,
    "gtype": "gage",
    "title": "Eko",
    "label": "µg/m³",
    "format": "{{payload}}",
    "min": 0,
    "max": "300",
    "colors": ["#40e400", "#ffff00", "#f91000"],
    "seg1": "Moderate",
    "seg2": "Unhealthy",
    "x": 680,
    "y": 140,
    "wires": []
  },
  {
    "id": "ac978c90.78f5a",
    "type": "comment",
    "z": "cf8099bf.e74d38",
    "name": "Display US AQI",
    "info": "",
    "x": 700,
    "y": 80,
    "wires": []
  },
  {
    "id": "ce8a92cb.92325",
    "type": "catch",
    "z": "cf8099bf.e74d38",
    "name": "Catch All",
    "scope": null,
    "uncaught": false,
    "x": 100,
    "y": 620,
    "wires": [["465ffc49.3f4654"]]
  },
  {
    "id": "465ffc49.3f4654",
    "type": "debug",
    "z": "cf8099bf.e74d38",
    "name": "Error Log",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 310,
    "y": 620,
    "wires": []
  },
  {
    "id": "804d6611.b04c68",
    "type": "comment",
    "z": "cf8099bf.e74d38",
    "name": "Handle All Error Exceptions",
    "info": "",
    "x": 150,
    "y": 560,
    "wires": []
  },
  {
    "id": "e7a61643.823848",
    "type": "status",
    "z": "cf8099bf.e74d38",
    "name": "",
    "scope": null,
    "x": 620,
    "y": 620,
    "wires": [["f1e4079b.5c5288"]]
  },
  {
    "id": "f1e4079b.5c5288",
    "type": "debug",
    "z": "cf8099bf.e74d38",
    "name": "Console - Status",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 870,
    "y": 620,
    "wires": []
  },
  {
    "id": "fb08c67a.4c9648",
    "type": "comment",
    "z": "cf8099bf.e74d38",
    "name": "Handle All Node Status",
    "info": "",
    "x": 660,
    "y": 560,
    "wires": []
  },
  {
    "id": "6feb62ca.9f615c",
    "type": "mqtt in",
    "z": "15974936.7b18a7",
    "name": "Sub: DUST",
    "topic": "DUST",
    "qos": "2",
    "datatype": "auto",
    "broker": "8675a6a8.d229b8",
    "x": 120,
    "y": 320,
    "wires": [["6a91ddfd.79d464", "2563ff5.937bd"]]
  },
  {
    "id": "6a91ddfd.79d464",
    "type": "debug",
    "z": "15974936.7b18a7",
    "name": "Console - Eko Dust",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 440,
    "y": 280,
    "wires": []
  },
  {
    "id": "928d7730.5d07f8",
    "type": "mqtt in",
    "z": "cf8099bf.e74d38",
    "name": "Sub: sensors/aqi/indoor",
    "topic": "sensors/aqi/indoor",
    "qos": "2",
    "datatype": "auto",
    "broker": "82d75fe6.a2011",
    "x": 140,
    "y": 140,
    "wires": [["50bfc332.c33dbc"]]
  },
  {
    "id": "2563ff5.937bd",
    "type": "mqtt out",
    "z": "15974936.7b18a7",
    "name": "Pub: sensors/aqi/indoor",
    "topic": "sensors/aqi/indoor",
    "qos": "",
    "retain": "",
    "broker": "82d75fe6.a2011",
    "x": 450,
    "y": 320,
    "wires": []
  },
  {
    "id": "2083c961.910fd6",
    "type": "comment",
    "z": "15974936.7b18a7",
    "name": "Sample MQTT Local",
    "info": "",
    "x": 150,
    "y": 40,
    "wires": []
  },
  {
    "id": "fc8843bc.bec05",
    "type": "comment",
    "z": "15974936.7b18a7",
    "name": "Dust Sensor (Eko)",
    "info": "",
    "x": 150,
    "y": 280,
    "wires": []
  },
  {
    "id": "81b338bb.f00578",
    "type": "mqtt out",
    "z": "15974936.7b18a7",
    "name": "Pub: DUST",
    "topic": "DUST",
    "qos": "",
    "retain": "",
    "broker": "8675a6a8.d229b8",
    "x": 550,
    "y": 460,
    "wires": []
  },
  {
    "id": "60e1f43c.54810c",
    "type": "function",
    "z": "15974936.7b18a7",
    "name": "Random AQI",
    "func": "function random(){\n    return Math.floor(Math.random() * 300);\n}\n\nreturn {\n    payload: random()\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 350,
    "y": 460,
    "wires": [["81b338bb.f00578"]]
  },
  {
    "id": "60622303.00dc3c",
    "type": "ui_button",
    "z": "15974936.7b18a7",
    "name": "Random Button",
    "group": "7190acf.653b054",
    "order": 1,
    "width": 0,
    "height": 0,
    "passthru": true,
    "label": "Random Dust (Eko)",
    "tooltip": "Sample AQI (Indoor)",
    "color": "",
    "bgcolor": "",
    "icon": "fa-random",
    "payload": "",
    "payloadType": "date",
    "topic": "",
    "x": 140,
    "y": 460,
    "wires": [["60e1f43c.54810c"]]
  },
  {
    "id": "dd63e5bb.e301c8",
    "type": "mqtt out",
    "z": "f56afe81.c9c94",
    "name": "Pub: info/web/corona",
    "topic": "info/web/corona",
    "qos": "",
    "retain": "",
    "broker": "82d75fe6.a2011",
    "x": 640,
    "y": 480,
    "wires": []
  },
  {
    "id": "d3018adc.2d2418",
    "type": "comment",
    "z": "f56afe81.c9c94",
    "name": "Publish Corona Data",
    "info": "",
    "x": 630,
    "y": 440,
    "wires": []
  },
  {
    "id": "d0d361bd.91405",
    "type": "mqtt out",
    "z": "7a35a7df.308d48",
    "name": "Pub: info/aqi/airvisual",
    "topic": "info/aqi/airvisual",
    "qos": "",
    "retain": "",
    "broker": "82d75fe6.a2011",
    "x": 620,
    "y": 300,
    "wires": []
  },
  {
    "id": "44d2f28e.bb5d6c",
    "type": "comment",
    "z": "7a35a7df.308d48",
    "name": "Publish AirVisual Data",
    "info": "",
    "x": 620,
    "y": 260,
    "wires": []
  },
  {
    "id": "8c47de30.ffc64",
    "type": "comment",
    "z": "15974936.7b18a7",
    "name": "Random Dust Volume (Eko)",
    "info": "",
    "x": 180,
    "y": 420,
    "wires": []
  },
  {
    "id": "373fda00.1de276",
    "type": "switch",
    "z": "5ae0159f.15184c",
    "name": "Filtered URL",
    "property": "payload",
    "propertyType": "msg",
    "rules": [{ "t": "nnull" }],
    "checkall": "false",
    "repair": false,
    "outputs": 1,
    "x": 570,
    "y": 140,
    "wires": [["e4d48288.317d5", "c1c128f5.b123e8"]]
  },
  {
    "id": "c1c128f5.b123e8",
    "type": "mqtt out",
    "z": "5ae0159f.15184c",
    "name": "Pub: info/proxy/url",
    "topic": "info/proxy/url",
    "qos": "",
    "retain": "",
    "broker": "82d75fe6.a2011",
    "x": 830,
    "y": 300,
    "wires": []
  },
  {
    "id": "28e7ddbd.09c812",
    "type": "comment",
    "z": "5ae0159f.15184c",
    "name": "Publish new URL",
    "info": "Publish new URL to the client via MQTT",
    "x": 820,
    "y": 260,
    "wires": []
  },
  {
    "id": "64e72b1c.1e6e64",
    "type": "mqtt in",
    "z": "15974936.7b18a7",
    "name": "Sub: info/#",
    "topic": "info/#",
    "qos": "2",
    "datatype": "auto",
    "broker": "82d75fe6.a2011",
    "x": 780,
    "y": 100,
    "wires": [["e7882757.2a67a8"]]
  },
  {
    "id": "e7882757.2a67a8",
    "type": "debug",
    "z": "15974936.7b18a7",
    "name": "Console - Info",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 960,
    "y": 100,
    "wires": []
  },
  {
    "id": "dc9ae4c0.0eb808",
    "type": "comment",
    "z": "15974936.7b18a7",
    "name": "Subscribe All Info (Local)",
    "info": "",
    "x": 830,
    "y": 60,
    "wires": []
  },
  {
    "id": "c7b649f9.817908",
    "type": "mqtt in",
    "z": "8f2390e0.2d8a9",
    "d": true,
    "name": "Sub: info/proxy/url",
    "topic": "info/proxy/url",
    "qos": "2",
    "datatype": "auto",
    "broker": "82d75fe6.a2011",
    "x": 130,
    "y": 100,
    "wires": [["26aeb2c0.58229e"]]
  },
  {
    "id": "bea7af4b.5777a",
    "type": "comment",
    "z": "8f2390e0.2d8a9",
    "name": "Update webhook URL for Bot",
    "info": "",
    "x": 160,
    "y": 60,
    "wires": []
  },
  {
    "id": "26aeb2c0.58229e",
    "type": "function",
    "z": "8f2390e0.2d8a9",
    "name": "Prepare Bot Data",
    "func": "return {\n  headers: {\n    Authorization: `Bearer ${env.get(\"EKO_BOT_TOKEN\")}`\n  },\n  method: \"POST\",\n  url: `${env.get(\"EKO_BOT_HOST\")}/api/v1/admin/bot/${env.get(\"EKO_BOT_ID\")}`,\n  payload: {\n    username: env.get(\"EKO_BOT_USERNAME\"),\n    webhookUrl: `${msg.payload}/events/bot`,\n    enabled: true,\n    linkedUserId: env.get(\"EKO_BOT_USER_ID\"),\n    systemUserId: env.get(\"EKO_BOT_ID\")\n  }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 370,
    "y": 100,
    "wires": [["e20edef4.2d0f3"]]
  },
  {
    "id": "e20edef4.2d0f3",
    "type": "http request",
    "z": "8f2390e0.2d8a9",
    "name": "POST: Bot Data",
    "method": "use",
    "ret": "txt",
    "paytoqs": false,
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "x": 600,
    "y": 100,
    "wires": [["23dfdc99.1eab74"]]
  },
  {
    "id": "9737baa7.983148",
    "type": "catch",
    "z": "8f2390e0.2d8a9",
    "name": "Catch All",
    "scope": null,
    "uncaught": false,
    "x": 100,
    "y": 520,
    "wires": [["26e828a8.7c0468"]]
  },
  {
    "id": "26e828a8.7c0468",
    "type": "debug",
    "z": "8f2390e0.2d8a9",
    "name": "Error Log",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 310,
    "y": 520,
    "wires": []
  },
  {
    "id": "f60e348f.adee98",
    "type": "comment",
    "z": "8f2390e0.2d8a9",
    "name": "Handle All Error Exceptions",
    "info": "",
    "x": 160,
    "y": 460,
    "wires": []
  },
  {
    "id": "6e1d637e.8810cc",
    "type": "status",
    "z": "8f2390e0.2d8a9",
    "name": "",
    "scope": null,
    "x": 560,
    "y": 520,
    "wires": [["ed1366ea.13e6a8"]]
  },
  {
    "id": "ed1366ea.13e6a8",
    "type": "debug",
    "z": "8f2390e0.2d8a9",
    "name": "Console - Status",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 830,
    "y": 520,
    "wires": []
  },
  {
    "id": "82edc804.442a88",
    "type": "comment",
    "z": "8f2390e0.2d8a9",
    "name": "Handle All Node Status",
    "info": "",
    "x": 600,
    "y": 460,
    "wires": []
  },
  {
    "id": "23dfdc99.1eab74",
    "type": "debug",
    "z": "8f2390e0.2d8a9",
    "name": "Console - Bot Data",
    "active": false,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 840,
    "y": 100,
    "wires": []
  },
  {
    "id": "e480b48b.816048",
    "type": "debug",
    "z": "8f2390e0.2d8a9",
    "name": "Console - Bot Events",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 510,
    "y": 200,
    "wires": []
  },
  {
    "id": "6adb095b.9d2aa8",
    "type": "http in",
    "z": "8f2390e0.2d8a9",
    "name": "Hook: events/bot",
    "url": "/events/bot",
    "method": "post",
    "upload": false,
    "swaggerDoc": "",
    "x": 120,
    "y": 200,
    "wires": [["e480b48b.816048", "a36d505a.c9e82"]]
  },
  {
    "id": "a36d505a.c9e82",
    "type": "http response",
    "z": "8f2390e0.2d8a9",
    "name": "Reply: OK",
    "statusCode": "200",
    "headers": { "node-red-state": "success" },
    "x": 470,
    "y": 240,
    "wires": []
  },
  {
    "id": "50bfc332.c33dbc",
    "type": "delay",
    "z": "cf8099bf.e74d38",
    "name": "Limit (5 sec.)",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "5",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "x": 370,
    "y": 140,
    "wires": [["7ad159b.cadf8a8"]]
  },
  {
    "id": "101fa3c8.8a72fc",
    "type": "comment",
    "z": "cf8099bf.e74d38",
    "name": "Rate Limit - 1 message per 5 sec.",
    "info": "",
    "x": 430,
    "y": 80,
    "wires": []
  }
]
